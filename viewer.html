<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <title>Physics Viewer</title>
  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/components.css" />
  <link rel="stylesheet" href="css/viewer.css" />

  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>

  <script type="text/javascript" charset="UTF-8"
    src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>

  <script>
    // MathJaxã®è¨­å®šã¯é…å»¶èª­ã¿è¾¼ã¿æ™‚ã«è¨­å®š
    window.MathJaxConfig = {
      tex: {
        inlineMath: [
          ["$", "$"],
          ["\\(", "\\)"],
        ],
        displayMath: [
          ["$$", "$$"],
          ["\\[", "\\]"],
        ],
        macros: {
          strong: ["\\textcolor{#3b82f6}{\\boldsymbol{#1}}", 1],
        },
      },
      svg: {
        fontCache: "global",
      },
    };
    
    // MathJaxã®é…å»¶èª­ã¿è¾¼ã¿
    function loadMathJax() {
      if (window.MathJax) return;
      window.MathJax = window.MathJaxConfig;
      var script = document.createElement('script');
      script.id = 'MathJax-script';
      script.async = true;
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.onload = function() {
        if (window.onMathJaxLoaded) window.onMathJaxLoaded();
      };
      document.head.appendChild(script);
    }
    
    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã¾ãŸã¯ä¸€å®šæ™‚é–“å¾Œã«MathJaxã‚’èª­ã¿è¾¼ã¿
    var mathJaxLoaded = false;
    function tryLoadMathJax() {
      if (mathJaxLoaded) return;
      mathJaxLoaded = true;
      setTimeout(loadMathJax, 500);
    }
    
    window.addEventListener('scroll', tryLoadMathJax, { once: true, passive: true });
    setTimeout(tryLoadMathJax, 2000);
  </script>
</head>

<body>
  <a href="#main-content" class="skip-link">ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¸ã‚¹ã‚­ãƒƒãƒ—</a>
  <header class="prob-header-top" role="banner">
    <div class="header-left">
      <a href="index.html" class="btn-back-circle" aria-label="ä¸€è¦§ã«æˆ»ã‚‹">â†</a>
      <h1 id="prob-title-header">èª­ã¿è¾¼ã¿ä¸­...</h1>
    </div>
    <div class="header-actions" role="group" aria-label="æ“ä½œ">
      <button type="button" id="btn-bookmark" class="btn-sm btn-bookmark" aria-label="ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã«è¿½åŠ " title="ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã«è¿½åŠ ">â˜† ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯</button>
      <button type="button" id="btn-toggle-pointer" class="btn-sm" aria-label="æ“ä½œãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿">ğŸ‘† æ“ä½œãƒ¢ãƒ¼ãƒ‰</button>
      <!-- éŸ³å£°æ©Ÿèƒ½ã¯ä¸€æ™‚çš„ã«éè¡¨ç¤º -->
      <!-- <button id="audio-generate-btn" class="btn-sm" style="display: none;" title="è£œè¶³èª¬æ˜ä»˜ãã§éŸ³å£°è§£èª¬ã‚’å†ç”Ÿ">ğŸ¤ éŸ³å£°è§£èª¬</button> -->
    </div>
  </header>

  <div class="viewer-container" id="main-content">
    <div class="viewer-split-content">
      <div id="sim-target" class="simulation-area" aria-label="ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é ˜åŸŸ"></div>

      <div id="text-target" class="explanation-area" role="article" aria-label="è§£èª¬"></div>
      <canvas id="pointer-canvas" class="pointer-canvas-inline" aria-hidden="true"></canvas>
    </div>
  </div>

  <!-- éŒ²ç”»ç”¨ãƒ•ãƒ­ãƒ¼ãƒˆã¯ body ç›´ä¸‹ã§ overflow ã®å½±éŸ¿ã‚’å—ã‘ãªã„ã‚ˆã†ã«ã™ã‚‹ -->
  <div id="recording-float-bar" class="recording-float-bar recording-float-bar--collapsed" aria-hidden="true">
    <button type="button" id="recording-float-trigger" class="recording-float-trigger" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º" title="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">â‹¯</button>
    <div class="recording-float-content">
      <button type="button" id="recording-btn-scroll-up" class="recording-float-btn recording-float-btn-scroll" title="ä¸Šã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«" aria-label="ä¸Šã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«">â†‘</button>
      <button type="button" id="recording-btn-scroll-down" class="recording-float-btn recording-float-btn-scroll" title="ä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«" aria-label="ä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«">â†“</button>
      <button type="button" id="recording-btn-clear" class="recording-float-btn" title="ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã®ç·šã‚’ã™ã¹ã¦æ¶ˆã™" aria-label="ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚’ã‚¯ãƒªã‚¢">ğŸ—‘ ã‚¯ãƒªã‚¢</button>
      <button type="button" id="recording-btn-fullscreen" class="recording-float-btn" title="ãƒ–ãƒ©ã‚¦ã‚¶ã‚’å…¨ç”»é¢" aria-label="å…¨ç”»é¢åˆ‡æ›¿">â›¶ å…¨ç”»é¢</button>
      <button type="button" id="recording-btn-exit" class="recording-float-btn recording-float-btn-exit" title="éŒ²ç”»ãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†" aria-label="éŒ²ç”»ãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†">çµ‚äº†</button>
    </div>
  </div>

  <!-- éŸ³å£°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ï¼ˆä¸€æ™‚çš„ã«éè¡¨ç¤ºï¼‰ -->
  <!--
  <div id="audio-controls-panel" class="audio-controls-panel" style="display: none;">
    <div class="audio-controls-header">
      <span>ğŸ¤ éŸ³å£°è§£èª¬</span>
      <button id="audio-close-btn" class="audio-close-btn">âœ•</button>
    </div>
    <div class="audio-controls-body">
      <div class="audio-progress-container">
        <div id="audio-progress" class="audio-progress"></div>
      </div>
      <div class="audio-buttons">
        <button id="audio-play-btn" class="audio-btn">â–¶ï¸ å†ç”Ÿ</button>
        <button id="audio-pause-btn" class="audio-btn" style="display: none;">â¸ï¸ ä¸€æ™‚åœæ­¢</button>
        <button id="audio-stop-btn" class="audio-btn">â¹ï¸ åœæ­¢</button>
      </div>
      <div id="audio-error" class="audio-error" style="display: none;"></div>
    </div>
  </div>
  -->

  <script src="js/error-handler.js"></script>
  <script src="js/sim-utils.js"></script>
  <script src="js/pointer.js"></script>
  <script src="js/text-extractor.js"></script>
  <script src="js/audio-enhancer.js"></script>
  <script src="js/audio-player.js"></script>
  <script src="js/mobile-touch.js"></script>
  <script src="js/viewer.js"></script>
  <script src="config/firebase-config.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js").catch(function () {});
    }
    if (window.firebaseConfig && window.firebaseConfig.apiKey !== "YOUR_API_KEY") {
      firebase.initializeApp(window.firebaseConfig);
      window.db = firebase.firestore();
      window.collection = (db, name) => db.collection(name);
      window.doc = (db, col, id) => db.collection(col).doc(id);
      window.setDoc = (docRef, data, opt) => docRef.set(data, opt);
    }
  </script>
</body>

</html>