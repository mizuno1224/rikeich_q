# 音声解説の強化機能

## 📋 概要

解説テキストをそのまま読み上げるのではなく、**補足説明や注目すべき箇所を明示しながら**教育的な解説音声を生成する機能を実装しました。

## ✨ 主な機能

### 1. 自動補足説明の追加

- **見出しの補足**: セクションタイプに応じた導入文を追加
  - 「解法の指針について説明します」
  - 「考え方について詳しく解説します」
  - 「答えについて説明します」

- **重要箇所の強調**: 
  - `.highlight` 要素 → 「特に注目すべき点として、○○があります」
  - `<strong>` 要素 → 「重要な『○○』です」

- **数式の補足**: 
  - 数式の前後に「この数式、○○を確認してください」を追加

### 2. セクションタイプの自動判定

解説の構造を分析し、適切な補足説明を追加：

- **`guidance`**: 解法の指針
- **`explanation`**: 考え方・解法
- **`question`**: 小問（(1), (2)など）
- **`answer`**: 答え
- **`summary`**: まとめ（box-alert）

### 3. 特殊要素の処理

- **シミュレーション**: 「画面のシミュレーションをご覧ください。動きを確認しながら理解を深めましょう。」
- **box-note（答え）**: 「答えは、○○となります。」
- **box-alert（ポイント）**: 「最後に、重要なポイントをまとめます。第一に、○○。第二に、○○。」

## 📁 実装ファイル

### 新規追加
- `js/audio-enhancer.js` - 解説テキストの強化処理

### 修正
- `js/viewer.js` - 強化機能の統合
- `viewer.html` - スクリプトの読み込み追加

## 🔧 技術的な詳細

### 処理フロー

1. **HTML構造の分析**
   - カード要素を検出
   - 見出し、段落、ハイライト、数式などを抽出

2. **セクションタイプの判定**
   - 見出しテキストとコンテンツ構造から判定
   - 適切な補足説明を選択

3. **テキストの強化**
   - 重要箇所に補足説明を追加
   - 数式に説明を付加
   - シミュレーションや答えに補足を追加

4. **音声生成**
   - 強化されたテキストを音声プレーヤーに渡す

### 補足説明の例

**元のテキスト:**
```
重要な語句や公式は 運動方程式 で強調します。
```

**強化後のテキスト:**
```
重要な語句や公式は、特に重要な「運動方程式」という概念に注目してください。で強調します。
```

**元のテキスト:**
```
$F = ma$
```

**強化後のテキスト:**
```
この数式、Fイコールmaを確認してください。
```

## 🎯 使用例

### 基本的な使い方

1. 解説ページを開く
2. 「🎤 音声解説」ボタンをクリック
3. 補足説明付きの音声解説が再生されます

### 補足説明のカスタマイズ

`js/audio-enhancer.js` の関数を修正することで、補足説明の内容をカスタマイズできます：

```javascript
// セクション導入文のカスタマイズ
function addSectionIntroduction(headingText, sectionType) {
  // カスタムロジックを追加
}

// ハイライト要素の補足説明をカスタマイズ
function enhanceParagraph(paragraph) {
  // カスタムロジックを追加
}
```

## 🔄 今後の拡張

### AIを使った高度な補足説明

現在はルールベースの補足説明ですが、AI（LLM）を使ってより自然で教育的な補足説明を生成することも可能です：

```javascript
// 将来的な実装例
async function enhanceWithAI(text, context) {
  const response = await fetch('/api/enhance-explanation', {
    method: 'POST',
    body: JSON.stringify({ text, context })
  });
  return await response.json();
}
```

### ポインター機能との連携

音声解説とポインター機能を連携させ、音声に合わせて自動的にポインターを表示することも可能です。

## 📝 注意事項

- 補足説明が多すぎると音声が長くなりすぎる可能性があります
- 必要に応じて補足説明の量を調整してください
- 数式の変換は基本的なもののみ対応しています

## 🐛 トラブルシューティング

### 補足説明が追加されない

- HTMLの構造が期待通りか確認
- `.highlight` や `<strong>` 要素が正しく使用されているか確認
- ブラウザのコンソールでエラーを確認

### 音声が長すぎる

- `js/audio-enhancer.js` の補足説明を簡潔に調整
- 不要な補足説明を削除

---

**実装日**: 2024年
**バージョン**: 1.0
