---
description: 問題画像を添付して解説ページを0から作成する／長い問題は小分けして増築する
globs:
  - data/explanations/**/*.html
  - data/materials/*.json
---

# 問題画像から解説を生成（Cursor 単体）

ユーザーが**問題画像**を添付し、解説ページの作成・追加を依頼した場合は、**外部AI（Gemini等）は使わず、Cursor 単体で**画像を読み取り、解説を0から生成する。

## 1. 基本の流れ

1. **画像の読み取り**：添付された問題画像から、大問タイトル・設問構成・図・数式・条件を把握する。
2. **保存先の決定**：大学名・年度・前期/後期・大問番号から、`data/explanations/exam_national/{folderName}/{year}/{year}_zenki_{大問}.html` 等のパスと、`data/materials/exam_national.json` の登録内容を決める。
3. **HTML の作成**：`.cursor/rules/explanation-pages.mdc` に従い、解法の指針・各設問の解説・答え・Point・図・シミュを盛り込んだ1本のHTMLを生成する。
4. **マニフェスト更新**：新規の場合は `exam_national.json` に問題を1件追加する。

## 2. 長い問題（入試大問など）は小分けして増築

- **入試問題のように設問が多く長い場合**は、いきなり全設問を一気に書かず、**小分けして依頼し、段階的に増築**する。
- 推奨の進め方：
  1. **1回目**：「この問題の解説ページの土台を作って。タイトル・解法の指針・問(1)の(a)(b)まででよい」のように、**冒頭＋最初の数小問**だけ作成する。保存パス・マニフェストもこのタイミングで作成・更新する。
  2. **2回目以降**：「問(1)(c)(d)を追加して」「問(2)の(a)(b)を追加して」のように、**既存のHTMLに追記**する。既存の `.card` の並びを崩さず、適切な位置に新しい `.card` を挿入する。
- これにより、**1回あたりの負荷を減らし、設問ごとの質を上げる**。

## 3. 増築時の注意

- 既存の解説ファイルを**上書きせず、指定された範囲の設問だけを追加**する。
- 追加する設問も、解法の指針で触れている「問題の構成」と整合するようにする（必要なら「問題の構成」の該当行を少し修正してよい）。
- 各設問カードには、答え（box-note）の直後に Point（box-alert）を置く。図・シミュは設問に応じて適宜入れる。

## 4. 大学名・パス・マニフェスト

- **folderName** 例：東北大学 → tohoku、九州大学 → kyushu、東京都立 → tokyotoritu、千葉大学 → chiba、筑波大学 → tsukuba。
- **ファイル名**：前期 `{year}_zenki_{大問}.html`、後期 `{year}_kou_{大問}.html`。
- **CSS 相対パス**：`data/explanations/exam_national/.../` の5階層下なので `../../../../../css/`。
- **exam_national.json**：該当 subject の該当年度 field の `problems` に `id`, `title`, `desc`, `explanationPath` を追加。既存 id があれば上書きしない（増築の場合は既存ファイルを更新するだけ）。

## 5. トリガーとなる依頼の例

- 「添付した問題画像から解説ページを作って」
- 「この入試問題の解説を0から書いて。まず問(1)(a)(b)までで」
- 「さっきの解説に問(1)(c)(d)を追加して」
