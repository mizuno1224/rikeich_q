# 音声再生機能 - 実装完了

## 📋 実装内容

解説ページにAI音声による読み上げ機能を追加しました。

## ✅ 実装された機能

1. **テキスト抽出機能** (`js/text-extractor.js`)
   - 解説HTMLからテキストを抽出
   - MathJax数式を読み上げ可能なテキストに変換
   - セクションごとに分割

2. **音声プレーヤー** (`js/audio-player.js`)
   - ブラウザ標準のWeb Speech APIを使用
   - 日本語音声での読み上げ
   - 再生・一時停止・停止機能
   - スクロールと音声の自動同期
   - 現在再生中のセクションのハイライト

3. **UI統合**
   - ヘッダーに「🎤 音声再生」ボタンを追加
   - 音声コントロールパネル（再生・停止・進捗表示）
   - レスポンシブ対応

## 🚀 使い方

1. **解説ページを開く**
   - 任意の問題の解説ページを表示

2. **音声再生を開始**
   - ヘッダーの「🎤 音声再生」ボタンをクリック
   - 音声コントロールパネルが表示されます

3. **音声の制御**
   - **▶️ 再生**: 音声を再生（一時停止後）
   - **⏸️ 一時停止**: 再生を一時停止
   - **⏹️ 停止**: 再生を停止して最初に戻る
   - **✕**: コントロールパネルを閉じる

4. **自動機能**
   - 音声に合わせて自動的にスクロール
   - 現在再生中のセクションが黄色でハイライト表示

## 📁 追加されたファイル

- `js/text-extractor.js` - テキスト抽出機能
- `js/audio-player.js` - 音声プレーヤー
- `AUDIO_FEATURE_README.md` - このドキュメント

## 🔧 修正されたファイル

- `viewer.html` - 音声コントロールUIを追加
- `viewer.js` - 音声機能の統合コードを追加
- `css/viewer.css` - 音声コントロールパネルのスタイルを追加

## ⚠️ 注意事項

### ブラウザ対応

- **対応ブラウザ**: Chrome, Edge, Safari（最新版）
- **非対応**: Firefox（Web Speech APIの実装が限定的）

### 音声品質

現在はブラウザ標準のWeb Speech APIを使用しています。
- **メリット**: 無料、追加設定不要
- **デメリット**: 音声品質が限定的

### 今後の改善

高品質な音声が必要な場合は、以下のサービスへの移行を検討：
- Google Cloud Text-to-Speech（推奨）
- OpenAI TTS API
- Azure Text-to-Speech

詳細は `VIDEO_EXPLANATION_GUIDE.md` を参照してください。

## 🐛 トラブルシューティング

### 音声ボタンが表示されない

- 解説ページが正しく読み込まれているか確認
- ブラウザのコンソールでエラーを確認

### 音声が再生されない

- ブラウザがWeb Speech APIに対応しているか確認
- ChromeまたはEdgeを使用してください
- ブラウザの音声設定を確認

### 数式の読み上げが不自然

- MathJax数式の変換は基本的なもののみ対応
- 複雑な数式は「数式」と読み上げられる場合があります

## 📝 技術的な詳細

### テキスト抽出

- `.card` 要素からテキストを抽出
- 見出し（`h3`, `h4`）と本文（`p`）を結合
- MathJax数式を読み上げ可能なテキストに変換

### 音声生成

- Web Speech APIの `SpeechSynthesisUtterance` を使用
- 日本語音声を自動選択
- セクションごとに順次再生

### 同期機能

- 音声の再生に合わせて自動スクロール
- 現在のセクションを視覚的にハイライト
- スムーズなスクロールアニメーション

## 🔄 次のステップ

1. **高品質音声への移行**
   - Google Cloud TTS APIの統合
   - Firebase Functionsでの実装

2. **動画生成機能**
   - MediaRecorder APIでの画面録画
   - 音声と画面の同期

3. **機能拡張**
   - 再生速度の調整
   - 音声の保存機能
   - オフライン対応

詳細は `VIDEO_EXPLANATION_GUIDE.md` を参照してください。

---

**実装日**: 2024年
**バージョン**: 1.0
