<div class="explanation-content">
  <h3>等速直線運動の実験</h3>
  <p>
    物体が一定の速度で直線上を動く運動を<strong>等速直線運動</strong>といいます。<br>
    以下のシミュレーションで、速度 $v$ を変えたときの $x-t$ グラフの傾きの変化を確認しましょう。
  </p>

  <div class="canvas-container" style="position:relative; margin:20px 0; border:1px solid #ccc; background:#f9f9f9;">
    <canvas id="simCanvas" width="600" height="300"></canvas>
    <div style="padding:10px;">
      <label>速度 $v$: <input type="range" id="vRange" min="1" max="10" value="2" step="0.5"></label>
      <span id="vVal">2.0</span> m/s
      <button id="btnReset" style="margin-left:20px;">リセット</button>
      <button id="btnStart">スタート</button>
    </div>
  </div>

  <script>
    (function(){
      const canvas = document.getElementById('simCanvas');
      const ctx = canvas.getContext('2d');
      const vRange = document.getElementById('vRange');
      const vVal = document.getElementById('vVal');
      const btnStart = document.getElementById('btnStart');
      const btnReset = document.getElementById('btnReset');

      let x = 0;
      let t = 0;
      let v = 2.0;
      let isRunning = false;
      let animId;

      // 初期描画
      draw();

      vRange.addEventListener('input', (e) => {
        v = parseFloat(e.target.value);
        vVal.textContent = v.toFixed(1);
      });

      btnStart.addEventListener('click', () => {
        if(isRunning) return;
        isRunning = true;
        loop();
      });

      btnReset.addEventListener('click', () => {
        isRunning = false;
        cancelAnimationFrame(animId);
        x = 0;
        t = 0;
        draw();
      });

      function loop() {
        if(!isRunning) return;
        // 簡易的な物理計算 (dt = 1/60s)
        const dt = 1/60;
        t += dt;
        x += v * dt * 20; // 20px = 1m とするスケール

        if(x > canvas.width) {
          x = 0; // ループさせる
        }

        draw();
        animId = requestAnimationFrame(loop);
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // グリッド
        ctx.strokeStyle = '#eee';
        ctx.beginPath();
        for(let i=0; i<canvas.width; i+=50) { ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); }
        ctx.stroke();

        // ボール
        ctx.fillStyle = '#3b82f6';
        ctx.beginPath();
        ctx.arc(50 + x, canvas.height/2, 15, 0, Math.PI*2);
        ctx.fill();
        
        // テキスト
        ctx.fillStyle = '#333';
        ctx.font = '16px sans-serif';
        ctx.fillText(`Time: ${t.toFixed(1)} s`, 10, 20);
        ctx.fillText(`Pos: ${(x/20).toFixed(1)} m`, 10, 40);
      }
    })();
  </script>
</div>