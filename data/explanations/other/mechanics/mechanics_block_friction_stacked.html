<h2 class="prob-title-sub">問題：2物体（積み重ね）の運動方程式と摩擦力</h2>

<div class="card">
  <h3>解法の指針</h3>
  <p>
    この問題は，積み重なった2つの物体の運動を扱う典型的な問題です。以下の3つのステップで考えます。
  </p>
  <ol>
    <li><strong>注目する物体を決める</strong>：今回は「台（質量 $M$）」の運動を追うため，台にはたらく力を洗い出します。</li>
    <li><strong>垂直方向の力のつりあい</strong>：摩擦力を計算するために必要な<span class="highlight">垂直抗力 $N$</span>を求めます。</li>
    <li><strong>水平方向の運動方程式</strong>：力の矢印を整理し，運動方程式 $ma = F$ を立てます。</li>
  </ol>
</div>

<div class="card">
  <h3>(1) 台の加速度 $a$ の導出</h3>
  
  <h4>Step 1: 垂直抗力 $N$ の決定</h4>
  <p>
    台には自身の重力 $Mg$ と，上の小物体からの押し下げ $mg$ がかかっています。<br>
    床からの垂直抗力 $N$ はこれらとつりあうため，<br>
    $$ N = Mg + mg = (M+m)g $$
    となります。よって，床との間の動摩擦力 $f'$ は，<br>
    $$ f' = \mu N = \mu(M+m)g $$
  </p>

  <h4>Step 2: 運動方程式の立式</h4>
  <p>
    水平右向きを正とすると，台にはたらく力は「引く力 $F$」と「左向きの摩擦力 $f'$」です。<br>
    ※台と小物体の間に摩擦はないため，水平方向の相互作用はありません。<br>
    台についての運動方程式は：
    $$ Ma = F - \mu(M+m)g $$
    $$ a = \frac{F - \mu(M+m)g}{M} $$
  </p>

  <h4>物理シミュレーション：力のバランスと加速度</h4>
  <p>
    スライダーを動かして条件を変えてみましょう。「実行/リセット」で動きを確認できます。
  </p>

  <div id="sim-container-v4" class="sim-embed" style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden;">
    <div id="sim-canvas-v4" style="height: 250px; background: #f8fafc;"></div>
    
    <div id="sim-panel-v4" style="padding: 15px; background: #f1f5f9; border-top: 1px solid #e2e8f0;">
        <div id="sim-sliders-v4"></div>
        <div id="sim-buttons-v4" style="margin-top: 10px; display: flex; gap: 10px;">
            <button id="btn-start-v4" style="padding: 5px 15px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">実行 / リセット</button>
        </div>
    </div>
  </div>

  <script>
    (function(){
      var canvasArea = document.getElementById('sim-canvas-v4');
      var slidersArea = document.getElementById('sim-sliders-v4');
      var startBtn = document.getElementById('btn-start-v4');
      if(!canvasArea || !slidersArea || !startBtn) return;

      var sketch = function(p) {
        var M = 5.0;
        var m = 2.0;
        var F = 80;
        var mu = 0.3;
        var g = 9.8;
        
        var boxX = 50;
        var velocity = 0;
        var isMoving = false;
        var groundY = 180;

        p.setup = function() {
          var w = canvasArea.clientWidth || 600;
          var h = 250;
          p.createCanvas(w, h).parent(canvasArea);
          p.textSize(15);
          
          // スライダーの追加（SimUtilsを使用）
          if(window.SimUtils) {
             slidersArea.innerHTML = ''; // クリア
             SimUtils.addSlider(slidersArea, "引く力 F ", 0, 150, 80, 1, function(v) { F = v; });
             SimUtils.addSlider(slidersArea, "摩擦係数 μ ", 0, 1.0, 0.3, 0.1, function(v) { mu = v; });
          }

          // ボタン機能の設定
          startBtn.onclick = function() {
              boxX = 50;
              velocity = 0;
              isMoving = true;
          };
        };

        p.draw = function() {
          p.background(248, 250, 252);
          
          // 計算
          var N = (M + m) * g;
          var fk = mu * N;
          var a = (F - fk) / M;
          if (a < 0) a = 0; 

          if (isMoving) {
            velocity += a * 0.1;
            boxX += velocity;
            // 画面外に出たら停止
            if (boxX > p.width) isMoving = false;
          }

          // 床の描画
          p.stroke(150);
          p.strokeWeight(1);
          p.line(0, groundY, p.width, groundY);
          for(var i=0; i<p.width; i+=20) p.line(i, groundY, i-10, groundY+10);

          // 台 M (赤)
          p.noStroke();
          p.fill(244, 63, 94);
          p.rect(boxX, groundY - 50, 100, 50);
          p.fill(255);
          p.textAlign(p.CENTER);
          p.text("M", boxX + 50, groundY - 25);

          // 小物体 m (青)
          // 摩擦がないため，地面に対して水平位置（初期位置x=100）を維持する
          var smallBoxX = 100; 
          // 台が下にある間だけ描画（台が通り過ぎると落ちる表現）
          if (smallBoxX > boxX && smallBoxX < boxX + 100) {
             p.fill(59, 130, 246);
             p.rect(smallBoxX - 15, groundY - 80, 30, 30);
             p.fill(255);
             p.text("m", smallBoxX, groundY - 60);
          }

          // 矢印と数値の表示
          p.fill(51);
          p.textAlign(p.LEFT);
          p.text("加速度 a = " + a.toFixed(2), 20, 30);
          p.text("動摩擦力 f' = " + fk.toFixed(1), 20, 55);

          // 力の矢印 (F)
          if (isMoving) {
              drawArrow(p, boxX + 100, groundY - 25, F * 0.8, "F", [200, 0, 0]);
              if (velocity > 0) {
                  drawArrow(p, boxX + 50, groundY, -fk * 0.8, "f'", [0, 0, 0]);
              }
          }
        };

        function drawArrow(p, x, y, len, label, col) {
          if (Math.abs(len) < 5) return;
          p.push();
          p.stroke(col[0], col[1], col[2]);
          p.strokeWeight(2);
          p.fill(col[0], col[1], col[2]);
          p.translate(x, y);
          p.line(0, 0, len, 0);
          var headSize = 6;
          if (len > 0) p.triangle(len, 0, len-headSize, -3, len-headSize, 3);
          else p.triangle(len, 0, len+headSize, -3, len+headSize, 3);
          p.noStroke();
          p.text(label, len > 0 ? len + 5 : len - 20, -5);
          p.pop();
        }

        p.windowResized = function() {
           var w = canvasArea.clientWidth;
           if(w > 0) p.resizeCanvas(w, 250);
        };
      };
      var myP5 = new p5(sketch);
      if(!window.p5Instances) window.p5Instances = [];
      window.p5Instances.push(myP5);
    })();
  </script>

  <div class="box-note">
    <strong>答え：</strong><br>
    選択肢 <strong>⑦</strong><br>
    $$ a = \frac{F - \mu(M+m)g}{M} $$
  </div>
</div>

<div class="box-alert">
  <span class="box-alert-label">Point</span>
  <h3>物理的なポイント</h3>
  <ul>
    <li><strong>垂直抗力：</strong> 上に載っている小物体の重さも床からの抗力に含まれることを忘れないようにしましょう。</li>
    <li><strong>摩擦の不在：</strong> 台と小物体に摩擦がない場合，台が加速しても小物体には水平方向の力がはたらかないため，慣性によって元の位置に留まり続けます。</li>
  </ul>
</div>