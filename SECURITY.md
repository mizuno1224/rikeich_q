# セキュリティ・一般公開時の注意

一般公開する際に実施済みの対応と、運用時の注意点です。

---

## 実施済みの対応

### 1. 公開ページに管理者向け表記を出さない
- 広告枠に「AdSense コードを設置できます」等の文言は表示していません。枠は空で、広告コードを注入すると表示されます（未設置時は `:empty` で非表示）。
- about の「リンクは運営者が設定してください」等の管理者向け注釈は削除済みです。

### 2. Firestore セキュリティルール
- `firestore.rules` を追加し、**student_logs** 以外のコレクションへのアクセスを拒否しています。
- デプロイ: `firebase deploy --only firestore:rules` で反映してください。未デプロイの場合はコンソールのルールが有効なままです。

### 3. 管理画面のURL
- **admin.html** は公開ページ（index / viewer / about / privacy）からリンクしていません。URL を知っている人のみアクセス可能です。必要なら認証やアクセス制限を検討してください。

### 4. エラー表示のエスケープ
- viewer のエラーメッセージは `escapeHtml()` を通してから表示しており、表示内容由来の XSS は抑止しています。解説 HTML は自前の静的ファイルのみ読み込む想定です。

---

## 運用時の推奨

### Firebase API キー
- `config/firebase-config.js` の API キーはクライアントに含まれるため、Firebase の仕様上「公開されてもよい」前提です。
- 悪用を抑えるため、[Firebase コンソール](https://console.firebase.google.com/) の「プロジェクトの設定」→「一般」→「アプリ」で、**アプリの制限**（HTTP リファラー等）を設定することを推奨します。

### 解説 HTML の更新
- 解説ページ（`data/explanations/` 以下）は静的 HTML をそのまま `innerHTML` で表示しています。不特定多数が編集できる仕組みにしない限り、同一オリジンの信頼できるコンテンツのみが表示されます。

### 定期的な確認
- Firebase の「使用量と請求」「Authentication」「Firestore」で不審な利用がないかたまに確認することを推奨します。
